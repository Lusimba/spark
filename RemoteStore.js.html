<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Spark Framework Source: core/RemoteStore.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.dark.css">

	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Spark Framework</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu inline">
						
						<li>
							<a href="spark.components.Button.html">spark.components.Button</a>
						</li>
						
						<li>
							<a href="spark.components.Checkbox.html">spark.components.Checkbox</a>
						</li>
						
						<li>
							<a href="spark.components.ComboBox.html">spark.components.ComboBox</a>
						</li>
						
						<li>
							<a href="spark.components.DraggableView.html">spark.components.DraggableView</a>
						</li>
						
						<li>
							<a href="spark.components.Field.html">spark.components.Field</a>
						</li>
						
						<li>
							<a href="spark.components.Form.html">spark.components.Form</a>
						</li>
						
						<li>
							<a href="spark.components.Input.html">spark.components.Input</a>
						</li>
						
						<li>
							<a href="spark.components.Label.html">spark.components.Label</a>
						</li>
						
						<li>
							<a href="spark.components.LabeledInput.html">spark.components.LabeledInput</a>
						</li>
						
						<li>
							<a href="spark.components.Modal.html">spark.components.Modal</a>
						</li>
						
						<li>
							<a href="spark.components.Overlay.html">spark.components.Overlay</a>
						</li>
						
						<li>
							<a href="spark.components.Password.html">spark.components.Password</a>
						</li>
						
						<li>
							<a href="spark.components.Radio.html">spark.components.Radio</a>
						</li>
						
						<li>
							<a href="spark.components.Textarea.html">spark.components.Textarea</a>
						</li>
						
						<li>
							<a href="spark.components.TextareaWithCharCounter.html">spark.components.TextareaWithCharCounter</a>
						</li>
						
						<li>
							<a href="spark.components.ToggleSwitch.html">spark.components.ToggleSwitch</a>
						</li>
						
						<li>
							<a href="spark.core.HistoryManager.html">spark.core.HistoryManager</a>
						</li>
						
						<li>
							<a href="spark.core.HistoryManager.TokenTransformer.html">spark.core.HistoryManager.TokenTransformer</a>
						</li>
						
						<li>
							<a href="spark.core.Object.html">spark.core.Object</a>
						</li>
						
						<li>
							<a href="spark.core.RemoteStore.html">spark.core.RemoteStore</a>
						</li>
						
						<li>
							<a href="spark.core.Router.html">spark.core.Router</a>
						</li>
						
						<li>
							<a href="spark.core.Store.html">spark.core.Store</a>
						</li>
						
						<li>
							<a href="spark.core.View.html">spark.core.View</a>
						</li>
						
						<li>
							<a href="spark.widgets.SignUp.html">spark.widgets.SignUp</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: core/RemoteStore.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">// Generated by github.com/steida/coffee2closure 0.1.9
goog.provide('spark.core.RemoteStore');
goog.require('spark.core.Store');
goog.require('spark.validation');
goog.require('spark.ajax');

/**
  RemoteStore implementation of the Spark Framework. Makes HTTP GET, POST
  PUT or DELETE request to manage the data on the server. Use fetch to get or
  update the data, use save to write data back to server or remove to delete
  the data from the server.

  @constructor
  @export
  @param   {Object=} options Class options.
  @param   {*=} data Class data
  @extends {spark.core.Store}
 */
spark.core.RemoteStore = function(options, data) {
  if (options == null) {
    options = {};
  }
  options.url || (options.url = options['url'] || null);
  options.idKey || (options.idKey = options['idKey'] || '_id');
  spark.core.RemoteStore.superClass_.constructor.call(this, options, data);
}
goog.inherits(spark.core.RemoteStore, spark.core.Store);

/**
  Saves the data to server or updates it on the server. If your data has
  `options.idKey` property it will make a PUT request to update the data
  otherwise it will make a `POST` request to save it to server. If server
  response includes an `options.idKey` RemoteStore will save the id and use
  it to update the data.

  @export
  @param {Function=} callback Callback function to handle the request.
 */
spark.core.RemoteStore.prototype.save = function(callback) {
  var POST, PUT, idKey, method, object, _ref;
  _ref = spark.ajax.RequestTypes, PUT = _ref.PUT, POST = _ref.POST;
  idKey = this.getOptions().idKey;
  method = this.get(idKey) ? PUT : POST;
  object = this.toObject();
  delete object[idKey];
  return spark.ajax.request({
    type: method,
    url: this.getUrl_(method),
    data: object,
    success: (function(_this) {
      return function(data) {
        if (method === 'POST') {
          _this.set(idKey, data[idKey]);
        }
        _this.emit(spark.core.RemoteStore.EventTypes.SAVED, data);
        if (callback) {
          return callback.call(_this, null, data);
        }
      };
    })(this),
    error: (function(_this) {
      return function(err) {
        _this.emit(spark.core.RemoteStore.EventTypes.SAVE_FAILED, err);
        if (callback) {
          return callback.call(_this, err, null);
        }
      };
    })(this)
  });
};

/**
  Fetches the store data from server. Uses idKey property to find the store
  on the server. You can use fetch to populate the store from the server or
  when you want to update store data with latest data on the server.
  Callback is optional. Depending the result `EventTypes.FETCHED` or
  `EventTypes.FETCH_FAILED` events will be triggered.

  @export
  @param {Function=} callback Callback function to handle the request.
 */
spark.core.RemoteStore.prototype.fetch = function(callback) {
  var method;
  method = spark.ajax.RequestTypes.GET;
  return spark.ajax.request({
    type: method,
    url: this.getUrl_(method),
    success: (function(_this) {
      return function(data) {
        var key, value;
        for (key in data) {
          value = data[key];
          _this.set(key, value);
        }
        _this.emit(spark.core.RemoteStore.EventTypes.FETCHED, data);
        if (callback) {
          return callback.call(_this, null, data);
        }
      };
    })(this),
    error: (function(_this) {
      return function(err) {
        _this.emit(spark.core.RemoteStore.EventTypes.FETCH_FAILED, err);
        if (callback) {
          return callback.call(_this, err, null);
        }
      };
    })(this)
  });
};

/**
  Removes a store on the server by making a HTTP DELETE request. Handle the
  response with a callback or emitted events. Depending the response
  `EventTypes.REMOVED` or `EventTypes.REMOVE_FAILED` events will be emitted.

  @export
  @param {Function=} callback Callback function to handle the request.
 */
spark.core.RemoteStore.prototype.remove = function(callback) {
  var method;
  method = spark.ajax.RequestTypes.DELETE;
  return spark.ajax.request({
    type: method,
    url: this.getUrl_(method),
    success: (function(_this) {
      return function(data) {
        _this.emit(spark.core.RemoteStore.EventTypes.REMOVED, data);
        if (callback) {
          return callback.call(_this, null, data);
        }
      };
    })(this),
    error: (function(_this) {
      return function(err) {
        _this.emit(spark.core.RemoteStore.EventTypes.REMOVE_FAILED, err);
        if (callback) {
          return callback.call(_this, err, null);
        }
      };
    })(this)
  });
};

/**
  This method allows RemoteStore to work with customized urls for different
  request types. If the `url` in `options` is string then RemoteStore will
  use it and don't touch it. It may also be a function which will return
  different urls for different request types. See the following example.

  ```coffee
    new spark.core.RemoteStore
      url: (type) ->
        if type is 'GET'
          return '/user/list'
        else if type is 'POST'
          return '/user'
  ```

  @private
  @param {string} method Request type to customize request url.
  @return {string} The request url.
 */
spark.core.RemoteStore.prototype.getUrl_ = function(method) {
  var url;
  url = this.getOptions().url;
  if (spark.validation.isFunction(url)) {
    url = url.call(this, method);
  }
  return url;
};

/**
  Emitted event types.

  @enum {string}
 */
spark.core.RemoteStore.EventTypes = {
  SAVED: 'Saved',
  SAVE_FAILED: 'SaveFailed',
  FETCHED: 'Fetched',
  FETCH_FAILED: 'FetchFailed',
  REMOVED: 'Removed',
  REMOVE_FAILED: 'RemoveFailed'
};</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					Spark Framework by Fatih Acet <fatih@fatihacet.com>
					<br />
					
					
		<span class="copyright">
		Copyright Â© 2014 - Fatih Acet
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on 2015-02-11T17:49:10+00:00 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
